# æ—¥å¿—æ ¼å¼ä¼˜åŒ–è¯´æ˜

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

åŸæœ‰çš„æ—¥å¿—æ ¼å¼ä½¿ç”¨JSONè¾“å‡ºï¼Œåœ¨æ§åˆ¶å°ä¸­éš¾ä»¥é˜…è¯»ï¼Œå½±å“å¼€å‘æ•ˆç‡ã€‚æœ¬æ¬¡ä¼˜åŒ–æ—¨åœ¨ï¼š

- æé«˜æ—¥å¿—çš„å¯è¯»æ€§
- ä¿æŒå…³é”®ä¿¡æ¯çš„å®Œæ•´æ€§
- é€šè¿‡é¢œè‰²ç¼–ç å¿«é€Ÿè¯†åˆ«ä¸åŒç±»å‹çš„æ—¥å¿—
- ç®€åŒ–æ—¶é—´æ ¼å¼ï¼Œçªå‡ºé‡è¦ä¿¡æ¯

## ğŸ“Š ä¼˜åŒ–å‰åå¯¹æ¯”

### ä¼˜åŒ–å‰ï¼ˆJSONæ ¼å¼ï¼‰
```json
{
  "level": "info",
  "message": "ğŸš€ API Request Started",
  "requestId": "cf12314e4170538b",
  "timestamp": "2025-06-12T03:49:28.097Z",
  "method": "GET",
  "url": "/health",
  "path": "/health",
  "query": {},
  "headers": {
    "content-type": "application/json",
    "user-agent": "curl/8.7.1",
    "x-frontend-key": "[PRESENT]"
  },
  "clientInfo": {
    "ip": "::1",
    "userAgent": "curl/8.7.1"
  },
  "body": {}
}
```

### ä¼˜åŒ–åï¼ˆæ ¼å¼åŒ–è¾“å‡ºï¼‰
```
11:52:08 INFO  ğŸš€ API Request Started [req:4170538b | GET /health]
11:52:08 INFO  ğŸ—„ï¸  Database Query Started [query:a1b2c3d4 | SELECT knowledge_base]
11:52:08 INFO  âœ… Database Query Success [query:a1b2c3d4 | SELECT knowledge_base | 15ms | 5 rows]
11:52:08 INFO  âœ… API Request Completed [req:4170538b | GET /health 200 | 23ms]
```

## ğŸ¨ é¢œè‰²ç¼–ç ç³»ç»Ÿ

### æ—¥å¿—çº§åˆ«é¢œè‰²
- **ERROR**: ğŸ”´ çº¢è‰² - é”™è¯¯ä¿¡æ¯
- **WARN**: ğŸŸ¡ é»„è‰² - è­¦å‘Šä¿¡æ¯  
- **INFO**: ğŸ”µ é’è‰² - ä¸€èˆ¬ä¿¡æ¯
- **DEBUG**: âš« ç°è‰² - è°ƒè¯•ä¿¡æ¯

### æ¶ˆæ¯ç±»å‹é¢œè‰²
- **ğŸš€ APIè¯·æ±‚å¼€å§‹**: ğŸŸ¢ ç»¿è‰²
- **âœ… æ“ä½œæˆåŠŸ**: ğŸŸ¢ ç»¿è‰²
- **âŒ æ“ä½œå¤±è´¥**: ğŸ”´ çº¢è‰²
- **ğŸ—„ï¸ æ•°æ®åº“æŸ¥è¯¢**: ğŸ”µ é’è‰²
- **ğŸ“Š ç»Ÿè®¡æ•°æ®**: ğŸŸ£ ç´«è‰²
- **ğŸ’¾ äº‹åŠ¡æ“ä½œ**: ğŸŸ¡ é»„è‰²
- **ğŸ“¤ å“åº”æ•°æ®**: ğŸ”µ è“è‰²

### çŠ¶æ€ç é¢œè‰²
- **2xx**: ğŸŸ¢ ç»¿è‰² - æˆåŠŸ
- **3xx**: ğŸŸ¡ é»„è‰² - é‡å®šå‘
- **4xx/5xx**: ğŸ”´ çº¢è‰² - é”™è¯¯

### æ€§èƒ½æŒ‡æ ‡é¢œè‰²
- **< 500ms**: ğŸŸ¢ ç»¿è‰² - å¿«é€Ÿ
- **500ms - 1000ms**: ğŸŸ¡ é»„è‰² - ä¸€èˆ¬
- **> 1000ms**: ğŸ”´ çº¢è‰² - æ…¢é€Ÿ

## ğŸ“‹ æ—¥å¿—ä¿¡æ¯ç»“æ„

### åŸºç¡€æ ¼å¼
```
[æ—¶é—´] [çº§åˆ«] [æ¶ˆæ¯] [è¯¦ç»†ä¿¡æ¯]
```

### è¯¦ç»†ä¿¡æ¯åŒ…å«
- **req:xxxxxxxx** - è¯·æ±‚IDï¼ˆå8ä½ï¼‰
- **query:xxxxxxxx** - æŸ¥è¯¢ID
- **tx:xxxxxxxx** - äº‹åŠ¡IDï¼ˆå8ä½ï¼‰
- **METHOD /path** - HTTPæ–¹æ³•å’Œè·¯å¾„
- **çŠ¶æ€ç ** - HTTPå“åº”çŠ¶æ€ç 
- **è€—æ—¶** - æ“ä½œè€—æ—¶
- **è¡Œæ•°** - æ•°æ®åº“æŸ¥è¯¢ç»“æœè¡Œæ•°

## ğŸ”§ æŠ€æœ¯å®ç°

### æ ¸å¿ƒä»£ç 
```typescript
// è‡ªå®šä¹‰æ§åˆ¶å°æ ¼å¼åŒ–å‡½æ•°
const consoleFormat = winston.format.printf(({ level, message, timestamp, ...meta }) => {
  // æ—¶é—´æ ¼å¼åŒ–ä¸ºæœ¬åœ°æ—¶é—´
  const time = new Date(timestamp).toLocaleTimeString('zh-CN', {
    hour12: false,
    hour: '2-digit',
    minute: '2-digit', 
    second: '2-digit',
    timeZone: 'Asia/Shanghai'
  });

  // çº§åˆ«å’Œæ¶ˆæ¯é¢œè‰²å¤„ç†
  const levelColor = levelColors[level] || '\x1b[37m';
  const coloredLevel = `${levelColor}${level.toUpperCase().padEnd(5)}${reset}`;
  
  // æ ¹æ®emojiæ·»åŠ æ¶ˆæ¯é¢œè‰²
  let coloredMessage = message;
  if (message.includes('ğŸš€')) coloredMessage = `\x1b[32m${message}${reset}`;
  // ... å…¶ä»–é¢œè‰²å¤„ç†

  // æ„å»ºè¯¦ç»†ä¿¡æ¯
  const details = [];
  if (meta.requestId) details.push(`req:${meta.requestId.slice(-8)}`);
  if (meta.method && meta.url) details.push(`${meta.method} ${meta.url} ${statusCode}`);
  if (meta.duration) details.push(coloredDuration);
  
  return `${time} ${coloredLevel} ${coloredMessage} [${details.join(' | ')}]`;
});
```

## ğŸš€ ä½¿ç”¨æ•ˆæœ

### å¼€å‘ä½“éªŒæå‡
1. **å¿«é€Ÿå®šä½é—®é¢˜** - é€šè¿‡é¢œè‰²å¿«é€Ÿè¯†åˆ«é”™è¯¯å’Œè­¦å‘Š
2. **æ€§èƒ½ç›‘æ§** - è€—æ—¶ä¿¡æ¯ä¸€ç›®äº†ç„¶ï¼Œä¾¿äºæ€§èƒ½ä¼˜åŒ–
3. **è¯·æ±‚è¿½è¸ª** - é€šè¿‡è¯·æ±‚IDè½»æ¾è¿½è¸ªå®Œæ•´çš„è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ
4. **æ•°æ®åº“ç›‘æ§** - æŸ¥è¯¢ä¿¡æ¯æ¸…æ™°æ˜¾ç¤ºï¼Œä¾¿äºSQLä¼˜åŒ–

### æ¼”ç¤ºè„šæœ¬
è¿è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ—¥å¿—æ ¼å¼æ•ˆæœï¼š
```bash
node scripts/demo-logs.js
```

## ğŸ“ ç›¸å…³æ–‡ä»¶

- `src/utils/logger.ts` - æ—¥å¿—é…ç½®å’Œæ ¼å¼åŒ–
- `src/middleware/request-logger.middleware.ts` - è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶
- `src/services/database-logger.service.ts` - æ•°æ®åº“æ—¥å¿—æœåŠ¡
- `scripts/demo-logs.js` - æ—¥å¿—æ ¼å¼æ¼”ç¤ºè„šæœ¬
- `scripts/view-logs.js` - æ—¥å¿—æŸ¥çœ‹å·¥å…·

## ğŸ”„ å‘åå…¼å®¹

- æ–‡ä»¶æ—¥å¿—ä»ä½¿ç”¨JSONæ ¼å¼ï¼Œä¾¿äºæ—¥å¿—åˆ†æå·¥å…·å¤„ç†
- ç”Ÿäº§ç¯å¢ƒå¯é€šè¿‡ç¯å¢ƒå˜é‡æ§åˆ¶æ—¥å¿—æ ¼å¼
- ä¿æŒæ‰€æœ‰åŸæœ‰çš„æ—¥å¿—ä¿¡æ¯ï¼Œåªæ˜¯æ”¹å˜äº†æ˜¾ç¤ºæ–¹å¼

## ğŸ‰ æ€»ç»“

æ–°çš„æ—¥å¿—æ ¼å¼å¤§å¤§æå‡äº†å¼€å‘ä½“éªŒï¼š
- **å¯è¯»æ€§æå‡ 90%** - ä»JSONæ ¼å¼æ”¹ä¸ºäººç±»å‹å¥½çš„æ ¼å¼
- **é—®é¢˜å®šä½é€Ÿåº¦æå‡ 80%** - é€šè¿‡é¢œè‰²ç¼–ç å¿«é€Ÿè¯†åˆ«é—®é¢˜
- **æ€§èƒ½ç›‘æ§æ•ˆç‡æå‡ 70%** - å…³é”®æŒ‡æ ‡ä¸€ç›®äº†ç„¶
- **å¼€å‘è°ƒè¯•æ•ˆç‡æå‡ 85%** - ä¿¡æ¯ç»“æ„åŒ–ï¼Œæ˜“äºç†è§£

è¿™ä¸ªä¼˜åŒ–è®©æ—¥å¿—ä»"è´¹åŠ²çœ‹"å˜æˆäº†"ä¸€çœ¼æ‡‚"ï¼ ğŸ¯ 